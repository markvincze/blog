<!DOCTYPE html>
<html lang="en">

<head>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-72523215-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-72523215-1');
  </script>

  <title>Setting up an AppVeyor pipeline for Golang</title>

  <link rel="stylesheet" href="/styles/styles.css">
  <script defer src="https://use.fontawesome.com/releases/v5.15.1/js/all.js"></script>
  <script defer src="/scripts/scripts.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
  <link rel="icon" href="/favicon.png" type="image/png" />

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="This post gives and Introduction to setting up a continuous delivery pipeline for a Golang-based project in AppVeyor." />
  <meta property="og:url" content="https://blog.markvincze.com/setting-up-an-appveyor-pipeline-for-golang/" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Setting up an AppVeyor pipeline for Golang" />
  <meta property="og:description" content="This post gives and Introduction to setting up a continuous delivery pipeline for a Golang-based project in AppVeyor." />
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@mrkvincze" />
  <meta name="twitter:title" content="Setting up an AppVeyor pipeline for Golang" />
  <meta name="twitter:description" content="This post gives and Introduction to setting up a continuous delivery pipeline for a Golang-based project in AppVeyor." />
  

</head>

<body>
  <div class="navbar-container">
    <nav class="navbar container is-max-desktop" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">

        <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarMenu">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div id="navbarMenu" class="navbar-menu has-text-white-ter">

        <div class="navbar-start">
          
          <a class="navbar-item" href="/">About</a>
          
          <a class="navbar-item" href="/posts">Blog</a>
          
          <a class="navbar-item" href="/projects">Projects</a>
          
          <a class="navbar-item" href="/cv.html">CV</a>
          
        </div>

        <div class="navbar-end pt-2 ml-2">
          <a class="icon is-medium" href="https://twitter.com/mrkvincze" target="_blank">
            <i class="fab fa-lg fa-twitter"></i>
          </a>
          <a class="icon is-medium" href="https://www.github.com/markvincze" target="_blank">
            <i class="fab fa-lg fa-github"></i>
          </a>
          <a class="icon is-medium" href="https://stackoverflow.com/users/974733/mark-vincze" target="_blank">
            <i class="fab fa-lg fa-stack-overflow"></i>
          </a>
          <a class="icon is-medium" href="https://www.linkedin.com/in/markvincze" target="_blank">
            <i class="fab fa-lg fa-linkedin"></i>
          </a>
          <a class="icon is-medium" href="/index.xml" target="_blank">
            <i class="fas fa-lg fa-rss"></i>
          </a>
        </div>
      </div>
    </nav>
  </div>

  <div class="hero-body">
    <div class="container has-text-centered">
      <a href="/">
        <h1 class="title is-2">
          Mark Vincze
        </h1>
      </a>
      <h2 class="subtitle is-5">
        Software Developer
      </h2>
    </div>
  </div>

  

<section class="section">
  <div class="container is-max-desktop">
    <h1 class="title is-1">Setting up an AppVeyor pipeline for Golang</h1>

    
      


<p class="mb-3 is-vcentered">
  <time class="has-text-grey" datetime="2016-07-16">Jul 16, 2016 &bull;</time>

  
  
  <a class="button is-link is-light is-primary is-small p-2 mr-1 is-uppercase has-text-weight-semibold" style="height: 2em; margin-top: 0.1em" href="https://blog.markvincze.com/tags/golang/">golang</a>
  
  
  <a class="button is-link is-light is-primary is-small p-2 mr-1 is-uppercase has-text-weight-semibold" style="height: 2em; margin-top: 0.1em" href="https://blog.markvincze.com/tags/appveyor/">appveyor</a>
  

</p>
    

    <article class="content mt-6">
      <p>Recently at my day job I have been working on a <a href="https://github.com/Travix-International/Travix.Core.Adk">Golang-based application</a>, for which I wanted to set up an automated CD pipeline for building and releasing. Our application is a command line tool, so the release part is basically copying and uploading the binaries to a specified location.</p>
<p>Since I have been using AppVeyor for my .NET Core projects (<a href="https://github.com/markvincze/Stubbery">Stubbery</a> and <a href="https://github.com/markvincze/rest-api-helpers">RestApiHelpers</a>), and it&rsquo;s working really nicely, it seemed to be the obvious choice for Golang as well.</p>
<p>I did a quick Google search, and was surprised, because I didn&rsquo;t find any guides about setting this up. On the other hand, I found the <code>appveyor.yml</code> file of another <a href="https://github.com/oschwald/maxminddb-golang/blob/master/appveyor.yml">open-source Golang-project</a>, which looked rather simple, so I decided to try to set up my pipeline based on that. It turned out to be even simpler than what I expected.</p>
<h2 id="setting-up-the-build">Setting up the build</h2>
<p>In this section I&rsquo;ll describe a sample AppVeyor configuration, which is enough to build a Golang application.
(I&rsquo;ll only focus on the parts relevant to Golang.)</p>
<p>We have two different options to configure AppVeyor projects: one is two use a management website to set the different properties of the project, and the other is to put an <code>appveyor.yml</code> file at the root of our repository, which describes the same settings, and is automatically processed by AppVeyor.</p>
<p>I chose the latter approach, because it keeps the configuration close to the source code, this way it&rsquo;s easy to track its history, and it can be part of pull requests. Furthermore, the <code>yml</code> file contains only the settings which are relevant for our project, so it&rsquo;s often quite small and easy to understand.</p>
<h3 id="the-appveyor-configuration">The AppVeyor configuration</h3>
<p>I&rsquo;ll show the relevant parts of the <code>appveyor.yml</code> file and describe them in detail.</p>
<h3 id="basic-settings">Basic settings</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">version</span>: <span style="color:#ae81ff">1.0.0</span><span style="color:#ae81ff">.{build}</span>

<span style="color:#f92672">platform</span>: <span style="color:#ae81ff">x64</span>

<span style="color:#f92672">branches</span>:
  <span style="color:#f92672">only</span>:
    - <span style="color:#ae81ff">master</span>
</code></pre></div><p>The version number can be customized to fit our needs, and it can be manually bumped when we are releasing a new version. The <code>{build}</code> argument is an internal environment variable of AppVeyor, which will be automatically bumped on every build.</p>
<p>I configured my pipeline to be triggered only by pushes to the master branch, this can be modified in the <code>branches</code> section.</p>
<h3 id="cloning-and-prerequisites">Cloning and prerequisites</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">clone_folder</span>: <span style="color:#ae81ff">c:\gopath\src\github.com\account\myproject</span>

<span style="color:#f92672">environment</span>:
  <span style="color:#f92672">GOPATH</span>: <span style="color:#ae81ff">c:\gopath</span>

<span style="color:#f92672">install</span>:
  - <span style="color:#ae81ff">echo %PATH%</span>
  - <span style="color:#ae81ff">echo %GOPATH%</span>
  - <span style="color:#ae81ff">set PATH=%GOPATH%\bin;c:\go\bin;%PATH%</span>
  - <span style="color:#ae81ff">go version</span>
  - <span style="color:#ae81ff">go env</span>
</code></pre></div><p>The <code>clone_folder</code> property specifies the location our repo gets cloned to. This is important in the Golang ecosystem, since we usually want our projects to reside under the folders specified by either the <code>GOROOT</code> or the <code>GOPATH</code> environment variables. Hence we are setting that root folder as the value of the <code>GOPATH</code> variable in the <code>environment</code> section.</p>
<p>It turns out that the default AppVeyor agent image — among <a href="https://www.appveyor.com/docs/installed-software">many other technologies</a> — comes with Go preinstalled, so in the <code>install</code> section we don&rsquo;t have to do any real installation.<br>
However, it&rsquo;s still a good idea to print out some dianostic information about our Go environment, which can help troubleshooting if the build goes south. We also add <code>%GOPATH%\bin</code> and <code>C:\go\bin</code> to the PATH, so we can use the go toolchain in our build scripts without specifying full paths.</p>
<h3 id="building">Building</h3>
<p>Depending on how complicated our build is, we can either use a <code>go build</code> command directly in our <code>appveyor.yml</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">build_script</span>:
  - <span style="color:#ae81ff">go build -o buildOutput\myapp -i .</span>
</code></pre></div><p>Or, if we have a more complicated build (for example in my case we are cross-compiling the application for three different platforms), it&rsquo;s a better idea to put a script doing the build in our repository (I used PowerShell), and execute that in the pipeline.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">build_script</span>:
  - <span style="color:#f92672">ps</span>: <span style="color:#ae81ff">.\build.ps1</span>
</code></pre></div><p>The next thing to specify is the list of files to use during the deployment. These have to be added to the <code>artifacts</code> section.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">artifacts</span>:
  - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">buildOutput/myapp</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">binary</span>
</code></pre></div><p>We can list multiple files if we are generating more than one build output.</p>
<h3 id="deployment">Deployment</h3>
<p>The last part is doing the actual deployment of our artifacts.<br>
Now this part will completely depend on the way we want to release are application. I only investigated using GitHub Releases, since that was perfect for my purposes, but AppVeyor has built-in support for numerous other systems (Amazon S3, different Azure services, NuGet, etc.). And I&rsquo;m sure we can roll our own deployment script as well.</p>
<p>Here is an example for setting up the <code>deploy</code> section for GitHub Releases.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">deploy</span>:
  <span style="color:#f92672">release</span>: <span style="color:#ae81ff">myapp-$(appveyor_build_version)</span>
  <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#39;This is a release of my awesome application.&#39;</span>
  <span style="color:#f92672">provider</span>: <span style="color:#ae81ff">GitHub</span>
  <span style="color:#f92672">auth_token</span>:
    <span style="color:#f92672">secure</span>: <span style="color:#ae81ff">ZkOJAiZBmapKpbiqovaofs+W0foBWaV9Jom4yBYzcRKlAk4Bee+5b7t+5LrQRVn8</span>
  <span style="color:#f92672">artifact</span>: <span style="color:#ae81ff">binary</span> <span style="color:#75715e"># This is the name we specified in the artifacts section.</span>
  <span style="color:#f92672">draft</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#f92672">prerelease</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#f92672">on</span>:
    <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">master</span>
</code></pre></div><p>Where the value of the <code>secure</code> property is a <strong>Personal access token</strong> we have to set up on the <a href="https://github.com/settings/tokens">settings page</a> of GitHub.</p>
<p>One gotcha is that we shouldn&rsquo;t add the raw value of our token to the <code>appveyor.yml</code>, since then anyone would be able to read it from our repository (and GitHub is actually smart enough to notice that we erroneously added the plain value of a token to our repo and disables it automatically).</p>
<p>We should rather encrypt it with the <strong>Encrypt data</strong> option on the AppVeyor management site, and use that value instead. AppVeyor will recognize that its an encrypted token and decrypt it automatically.</p>
<p>So this is the complete <code>appveyor.yml</code> file we have to put at the root of our repository to get a basic build working. (More details about all the settings can be found in <a href="https://www.appveyor.com/docs">official documentation</a>.)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">version</span>: <span style="color:#ae81ff">1.0.0</span><span style="color:#ae81ff">.{build}</span>

<span style="color:#f92672">platform</span>: <span style="color:#ae81ff">x64</span>

<span style="color:#f92672">branches</span>:
  <span style="color:#f92672">only</span>:
    - <span style="color:#ae81ff">master</span>

<span style="color:#f92672">clone_folder</span>: <span style="color:#ae81ff">c:\gopath\src\github.com\account\myproject</span>

<span style="color:#f92672">environment</span>:
  <span style="color:#f92672">GOPATH</span>: <span style="color:#ae81ff">c:\gopath</span>

<span style="color:#f92672">install</span>:
  - <span style="color:#ae81ff">echo %PATH%</span>
  - <span style="color:#ae81ff">echo %GOPATH%</span>
  - <span style="color:#ae81ff">set PATH=%GOPATH%\bin;c:\go\bin;%PATH%</span>
  - <span style="color:#ae81ff">go version</span>
  - <span style="color:#ae81ff">go env</span>

<span style="color:#f92672">build_script</span>:
  - <span style="color:#ae81ff">go build -o buildOutput\myapp -i .</span>

<span style="color:#f92672">build_script</span>:
  - <span style="color:#f92672">ps</span>: <span style="color:#ae81ff">.\build.ps1</span>

<span style="color:#f92672">artifacts</span>:
  - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">buildOutput/myapp</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">binary</span>

<span style="color:#f92672">deploy</span>:
  <span style="color:#f92672">release</span>: <span style="color:#ae81ff">myapp-$(appveyor_build_version)</span>
  <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#39;This is a release of my awesome application.&#39;</span>
  <span style="color:#f92672">provider</span>: <span style="color:#ae81ff">GitHub</span>
  <span style="color:#f92672">auth_token</span>:
    <span style="color:#f92672">secure</span>: <span style="color:#ae81ff">FW3tJ3fMncxvs58/ifSP7w+kBl9BlxvRMr9liHmnBs14ALRG8Vfyol+sNhj9u2JA</span>
  <span style="color:#f92672">artifact</span>: <span style="color:#ae81ff">binary</span> <span style="color:#75715e"># This is the name we specified in the artifacts section.</span>
  <span style="color:#f92672">draft</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#f92672">prerelease</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#f92672">on</span>:
    <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">master</span>
</code></pre></div><p>I think this example shows that setting up a build pipeline for a Golang project in AppVeyor is really simple, and I hope this post will save some time for people getting started with continuous delivery in Golang.</p>

    </article>

    
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'https:\/\/blog.markvincze.com\/setting-up-an-appveyor-pipeline-for-golang\/';
        
        this.page.identifier = 'ghost-24';
        
      };
      (function () { 
        var d = document, s = d.createElement('script');
        s.src = 'https://markvinczeblog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  

</section>



  <div style="flex: 1"></div>

  <footer class="footer py-6">
    <div class="content has-text-centered">
      <p>
        © 2020 <strong>Mark Vincze</strong>. All rights reserved.<br />
        Built with <a href="https://gohugo.io/">Hugo</a> and <a href="https://bulma.io/">Bulma</a>. 💙
      </p>
    </div>
  </footer>

</body>

</html>